import{r as e,s as t,c as a,w as s,i as l,o as i,a as n,b as u,t as c,n as d,d as r,e as o,f as v}from"./index-CQI52f9_.js";const f="https://monitor.sanli.cn:3000/api";const g=((e,t)=>{const a=e.__vccOpts||e;for(const[s,l]of t)a[s]=l;return a})({data:()=>({deviceList:[{id:"13012345005",name:"DTU设备1"},{id:"13012345001",name:"DTU设备2"},{id:"13912345678",name:"DTU设备3"},{id:"13912345679",name:"DTU设备4"}],selectedIndex:0,deviceStatus:{isOnline:!1,dtuNo:"",deviceName:"",rcvTime:"",voltageAB:"",voltageBC:"",voltageCA:"",currentA:"",currentB:"",currentC:"",energy:"",pressure:"",relayStatus:""},timer:null,onlineDevices:[]}),onLoad(){this.startPolling()},onUnload(){this.stopPolling()},computed:{formattedTime(){if(!this.deviceStatus.rcvTime)return"--";const e=new Date(this.deviceStatus.rcvTime),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return`${e.getFullYear()}/${t}/${a} ${s}:${l}:${i}`}},methods:{onDeviceChange(e){this.selectedIndex=e.detail.value,this.getDeviceStatus()},startPolling(){this.getDeviceStatus(),this.timer=setInterval((()=>{this.getDeviceStatus()}),1e3)},stopPolling(){this.timer&&(clearInterval(this.timer),this.timer=null)},async getDeviceStatus(){try{const t=this.deviceList[this.selectedIndex].id,a=await e({url:`${f}/online-dtus`,method:"GET"});if(a.data.success){const s=a.data.devices.map((e=>e.dtuNo)).includes(t);if(this.deviceStatus.isOnline=s,s){const a=await e({url:`${f}/dtu-status/${t}`,method:"GET"});a.data.success&&(this.deviceStatus={...a.data.data,isOnline:s})}else this.deviceStatus={isOnline:!1,dtuNo:t,deviceName:this.deviceList[this.selectedIndex].name,rcvTime:"",voltageAB:"",voltageBC:"",voltageCA:"",currentA:"",currentB:"",currentC:"",energy:"",pressure:"",relayStatus:""}}}catch(a){console.error("获取设备状态失败:",a),t({title:"获取设备状态失败",icon:"none"})}},async toggleRelay(a){const s=this.deviceList[this.selectedIndex].id;if(this.deviceStatus.isOnline)try{this.stopPolling();const l=await e({url:`${f}/control/relay`,method:"POST",data:{dtuNo:s,command:a?"ON":"OFF"},header:{"content-type":"application/json"}});0===l.data.code?(this.deviceStatus.relayStatus=a?"闭合":"断开",t({title:"操作成功",icon:"success"}),setTimeout((()=>{this.startPolling()}),1e3)):(this.startPolling(),t({title:l.data.message||"控制失败",icon:"none"}))}catch(l){this.startPolling(),t({title:"控制失败",icon:"none"})}else t({title:"设备离线，无法控制",icon:"none"})}}},[["render",function(e,t,f,g,m,_){const h=r,S=l,p=o,y=v;return i(),a(S,{class:"container"},{default:s((()=>[n(S,{class:"device-select"},{default:s((()=>[n(p,{onChange:_.onDeviceChange,value:m.selectedIndex,range:m.deviceList,"range-key":"name"},{default:s((()=>[n(S,{class:"picker-button"},{default:s((()=>[n(h,{class:"device-label"},{default:s((()=>[u("当前设备:")])),_:1}),n(h,{class:"device-name"},{default:s((()=>[u(c(m.deviceList[m.selectedIndex].name),1)])),_:1}),n(h,{class:"picker-arrow"},{default:s((()=>[u("▼")])),_:1})])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),n(S,{class:"status-panel"},{default:s((()=>[n(S,{class:"status-item status-connection"},{default:s((()=>[n(h,null,{default:s((()=>[u("设备状态:")])),_:1}),n(h,{class:d({online:m.deviceStatus.isOnline,offline:!m.deviceStatus.isOnline})},{default:s((()=>[u(c(m.deviceStatus.isOnline?"在线":"离线"),1)])),_:1},8,["class"])])),_:1}),n(S,{class:"status-item status-time"},{default:s((()=>[n(h,null,{default:s((()=>[u("更新时间:")])),_:1}),n(h,null,{default:s((()=>[u(c(_.formattedTime),1)])),_:1})])),_:1}),n(S,{class:"status-item voltage"},{default:s((()=>[n(h,null,{default:s((()=>[u("AB线电压:")])),_:1}),n(h,null,{default:s((()=>[u(c(m.deviceStatus.voltageAB||"--")+" V",1)])),_:1})])),_:1}),n(S,{class:"status-item voltage"},{default:s((()=>[n(h,null,{default:s((()=>[u("BC线电压:")])),_:1}),n(h,null,{default:s((()=>[u(c(m.deviceStatus.voltageBC||"--")+" V",1)])),_:1})])),_:1}),n(S,{class:"status-item voltage"},{default:s((()=>[n(h,null,{default:s((()=>[u("CA线电压:")])),_:1}),n(h,null,{default:s((()=>[u(c(m.deviceStatus.voltageCA||"--")+" V",1)])),_:1})])),_:1}),n(S,{class:"status-item current"},{default:s((()=>[n(h,null,{default:s((()=>[u("A相电流:")])),_:1}),n(h,null,{default:s((()=>[u(c(m.deviceStatus.currentA||"--")+" A",1)])),_:1})])),_:1}),n(S,{class:"status-item current"},{default:s((()=>[n(h,null,{default:s((()=>[u("B相电流:")])),_:1}),n(h,null,{default:s((()=>[u(c(m.deviceStatus.currentB||"--")+" A",1)])),_:1})])),_:1}),n(S,{class:"status-item current"},{default:s((()=>[n(h,null,{default:s((()=>[u("C相电流:")])),_:1}),n(h,null,{default:s((()=>[u(c(m.deviceStatus.currentC||"--")+" A",1)])),_:1})])),_:1}),n(S,{class:"status-item energy"},{default:s((()=>[n(h,null,{default:s((()=>[u("用电量:")])),_:1}),n(h,null,{default:s((()=>[u(c(m.deviceStatus.energy||"--")+" kWh",1)])),_:1})])),_:1}),n(S,{class:"status-item pressure"},{default:s((()=>[n(h,null,{default:s((()=>[u("压力:")])),_:1}),n(h,null,{default:s((()=>[u(c(m.deviceStatus.pressure||"--")+" MPa",1)])),_:1})])),_:1})])),_:1}),n(S,{class:"control-panel"},{default:s((()=>[n(S,{class:"relay-item"},{default:s((()=>[n(S,{class:"relay-status"},{default:s((()=>[n(h,{class:"relay-label"},{default:s((()=>[u("继电器状态:")])),_:1}),n(h,{class:d(["relay-value","闭合"===m.deviceStatus.relayStatus?"relay-on":"relay-off"])},{default:s((()=>[u(c(m.deviceStatus.relayStatus||"--"),1)])),_:1},8,["class"])])),_:1}),n(y,{checked:"闭合"===m.deviceStatus.relayStatus,onChange:t[0]||(t[0]=e=>_.toggleRelay(e.detail.value)),disabled:!m.deviceStatus.isOnline,class:"relay-switch"},null,8,["checked","disabled"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-89b5d81a"]]);export{g as default};
